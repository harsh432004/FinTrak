"use strict";function ownKeys(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),n.push.apply(n,t)}return n}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(n,!0).forEach(function(e){_defineProperty(r,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})}return r}function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var jwt=require("jsonwebtoken"),asyncHandler=require("express-async-handler"),bcrypt=require("bcrypt"),User=require("../models/userModal"),crypto=require("crypto"),register=asyncHandler(function(r,n){var t,s,a,i,o,c,u,d,p,m,f,y,g,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.body,s=t.name,a=t.email,i=t.phone,o=t.password,c=t.address,u=t.identificationType,d=t.balance,p=t.moneyReceived,m=t.moneySend,f=t.requestReceived,s&&a&&o&&i&&c&&u||n.status(400).json({message:"Please add all fields"}),e.next=4,regeneratorRuntime.awrap(User.findOne({email:a}));case 4:if(e.sent)return n.status(400).json({message:"User already exists"}),e.abrupt("return");e.next=8;break;case 8:return e.next=10,regeneratorRuntime.awrap(bcrypt.genSalt(10));case 10:return y=e.sent,e.next=13,regeneratorRuntime.awrap(bcrypt.hash(o,y));case 13:return g=e.sent,e.next=16,regeneratorRuntime.awrap(User.create({name:s,email:a,balance:d,password:g,phone:i,address:c,identificationType:u,moneySend:m,moneyReceived:p,requestReceived:f,identificationNumber:crypto.randomBytes(6).toString("hex"),isAdmin:!1,isVerified:!0}));case 16:(l=e.sent)?n.status(201).json({_id:l.id,name:l.name,balance:l.balance,email:l.email,phone:l.phone,address:l.address,moneySend:l.moneySend,moneyReceived:l.moneyReceived,requestReceived:l.requestReceived,identificationType:l.identificationType,identificationNumber:l.identificationNumber,isAdmin:l.isAdmin,isVerified:l.isVerified,token:generateToken(l._id)}):n.status(400).json({message:"Invalid user data"});case 18:case"end":return e.stop()}})}),login=asyncHandler(function(r,n){var t,s,a,i,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.body,s=t.email,a=t.password,console.log(s,a),e.next=4,regeneratorRuntime.awrap(User.findOne({email:s}));case 4:if(i=e.sent,e.t0=i,e.t0)return e.next=9,regeneratorRuntime.awrap(bcrypt.compare(a,i.password));e.next=10;break;case 9:e.t0=e.sent;case 10:if(!e.t0){e.next=16;break}delete(o=i.toObject()).password,n.status(200).json(_objectSpread({},o,{token:generateToken(i._id)})),e.next=17;break;case 16:n.status(401).json({message:"Invalid credentials"});case 17:case"end":return e.stop()}})}),currentUser=asyncHandler(function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t={_id:r.user._id,email:r.user.email,name:r.user.name},n.status(200).json(t);case 2:case"end":return e.stop()}})}),getUsers=asyncHandler(function(r,n){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(User.find());case 2:t=e.sent,(s=t.filter(function(e){return e._id.toString()!==r.user._id.toString()}))?n.status(200).json(s):n.status(404).json({message:"User not found"});case 5:case"end":return e.stop()}})}),verify=asyncHandler(function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(User.findByIdAndUpdate(r.params.id,{isVerified:r.body.isVerified},{new:!0}));case 2:(t=e.sent)?n.status(201).json({_id:t._id,name:t.name,isVerified:t.isVerified}):n.status(404).json({message:"User not found"});case 4:case"end":return e.stop()}})}),getImage=asyncHandler(function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(User.findById(r.user._id));case 2:(t=e.sent).image?n.status(201).json(t.image):n.status(404).json({message:"No user image"});case 4:case"end":return e.stop()}})}),generateToken=function(e){return jwt.sign({id:e},process.env.JWT_SECRET,{expiresIn:"30d"})};module.exports={register:register,login:login,currentUser:currentUser,getUsers:getUsers,verify:verify,getImage:getImage};
//# sourceMappingURL=userController.min.js.map
